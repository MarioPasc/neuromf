# Phase 4 training config (skeleton prepared in Phase 3)
# Full training configuration for MeanFlow on brain MRI latents

# Model
unet:
  spatial_dims: 3
  in_channels: 4
  out_channels: 4
  channels: [64, 128, 256, 512]
  attention_levels: [false, false, true, true]
  num_res_blocks: 2
  num_head_channels: [0, 0, 32, 32]
  norm_num_groups: 32
  resblock_updown: true
  transformer_num_layers: 1
  use_flash_attention: false
  with_conditioning: false
  prediction_type: x
  t_min: 0.05

# Training
training:
  batch_size: 24
  lr: 1.0e-4
  weight_decay: 0.0
  optimizer: adamw
  betas: [0.9, 0.999]
  max_epochs: 500
  warmup_steps: 5000
  gradient_clip_norm: 1.0
  gradient_checkpointing: true
  mixed_precision: bf16
  log_every_n_steps: 50
  val_every_n_epochs: 10
  save_every_n_epochs: 50

# MeanFlow
meanflow:
  p: 2.0
  adaptive: true
  norm_eps: 0.01
  lambda_mf: 1.0
  prediction_type: x
  t_min: 0.05
  jvp_strategy: exact
  fd_step_size: 1.0e-3
  channel_weights: null

# Time sampling
time_sampling:
  distribution: logit_normal
  mu: -0.4
  sigma: 1.0
  t_min: 0.001
  data_proportion: 0.25

# EMA
ema:
  decay: 0.999

# Paths (will be merged with base.yaml)
paths:
  latents_dir: ${paths.results_root}/latents
  checkpoints_dir: ${paths.results_root}/training_checkpoints
  logs_dir: ${paths.results_root}/phase_4/logs
